{% load btss_extras %}
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>btSchoolSafety</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/quasar@2.10.1/dist/quasar.prod.css"
      rel="stylesheet"
      type="text/css"
    />
  </head>

  <body>
    <div id="q-app">
      <q-layout view="hHh Lpr fFf">
        <q-header elevated class="bg-primary text-white">
          <q-toolbar class="q-gutter-sm">
            <q-btn
              flat
              @click="drawerLeft = !drawerLeft"
              round
              dense
              icon="menu"
            ></q-btn>
            <q-toolbar-title>
              btSchoolSafety
              <q-chip
                v-if="!!emergencyType"
                color="{{ emergency_type|to_color }}"
                text-color="white"
              >
                {{ emergency_type|to_label }}
              </q-chip>
            </q-toolbar-title>

            <q-btn flat @click="redirectToDeactivate">Deactivate</q-btn>
            <q-btn flat round dense icon="more_vert">
              <q-menu>
                <q-list>
                  <q-item clickable v-close-popup @click="redirectToLogout">
                    <q-item-section class="text-no-wrap">
                      Log out
                    </q-item-section>
                  </q-item>
                </q-list>
              </q-menu>
            </q-btn>
          </q-toolbar>
        </q-header>

        <q-drawer
          v-model="drawerLeft"
          show-if-above
          :width="375"
          :breakpoint="500"
          bordered
          overlay
        >
          <q-list bordered separator>
            <q-item>
              <q-item-section>
                <div class="text-h6">[[ buildingName ]]</div>
              </q-item-section>
            </q-item>
            <q-item clickable v-for="(reporting, index) in roomReportings">
              <q-item-section overline>
                [[ reporting.roomName]]
              </q-item-section>
              <q-item-section side>
                [[ reporting.numStudentsNearby ]] students nearby
              </q-item-section>
            </q-item>
          </q-list>
        </q-drawer>

        <q-page-container>
          <q-page padding>
            <p>Map here</p>
          </q-page>
        </q-page-container>
      </q-layout>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/quasar@2.10.1/dist/quasar.umd.prod.js"></script>

    <script>
      const app = Vue.createApp({
        delimiters: ["[[", "]]"],
        data() {
          return {
              drawerLeft: true,
              emergencyType: {{ emergency_type|quote }},
              buildingName: {{ building_name|quote }},
              roomReportings: [
                {% for reporting in room_reportings %}
                {
                  roomName: {{ reporting.room_name|quote }},
                  numStudentsNearby: {{ reporting.num_students_nearby }},
                },
                {% endfor %}
              ]
          };
        },
        setup() {
          return {};
        },
        methods: {
          redirectToLogout() {
            window.location.href = "/accounts/logout";
          },
          redirectToDeactivate() {
            window.location.href = "/system/deactivate";
          },
        },
      });

      app.use(Quasar);
      app.mount("#q-app");
    </script>
  </body>
</html>
